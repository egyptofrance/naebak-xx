# ๐บ๏ธ ุชุญููู ูุธุงู ุชูุนูู ูุฅุทูุงุก ุงููุญุงูุธุงุช

**ุงูุชุงุฑูุฎ:** 5 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุจูุงุกู ุนูู ุทูุจูุ ุชู ุฅุฌุฑุงุก ุชุญููู ุดุงูู ููุธุงู ุฅุฏุงุฑุฉ ุงููุญุงูุธุงุช (ุงูุชูุนูู ูุงูุฅุทูุงุก) ุงูููุฌูุฏ ูู ูุดุฑูุน `naebak-xx`. ูุฐุง ุงูุชูุฑูุฑ ููุถุญ ุขููุฉ ุนูู ุงููุธุงูุ ูููุฒุงุชูุ ุฅููุงููุงุชูุ ููุงุฆุฏูุ ูุนููุจู ุงููุญุชููุฉ.

ุงููุธุงู ูุตูู ููุณูุงุญ ููุฃุฏูู ุจุงูุชุญูู ูู **ุฑุคูุฉ (visibility)** ุงููุญุงูุธุงุช ูู ุงูุชุทุจููุ ููุง ูุชูุญ **ุงููุดุฑ ุงูุชุฏุฑูุฌู (Phased Rollout)** ูููุญุชูู ูุงูุฎุฏูุงุช.

---

## โ๏ธ ููู ูุนูู ุงููุธุงูุ (ุงูุชุญููู ุงูููู)

ูุนุชูุฏ ุงููุธุงู ุนูู ุจููุฉ ูุชูุงููุฉ ุชุชููู ูู 3 ุทุจูุงุช ุฑุฆูุณูุฉ: ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ุงููุงุฌูุฉ ุงูุฎูููุฉ (Server Actions)ุ ูุงููุงุฌูุฉ ุงูุฃูุงููุฉ (ููุญุฉ ุงูุฃุฏูู ูุงูุตูุญุงุช ุงูุนุงูุฉ).

### 1. ุทุจูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Layer)

- **ุงูุฌุฏูู ุงูุฑุฆูุณู:** `governorates`
- **ุงูุญูู ุงูุฃุณุงุณู:** ุชู ุฅุถุงูุฉ ุญูู ุฌุฏูุฏ ุฅูู ุฌุฏูู `governorates`:
  - `is_visible` (ูู ููุน `BOOLEAN`)
- **ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ:** `false` (ุฌููุน ุงููุญุงูุธุงุช ูุฎููุฉ ุจุดูู ุงูุชุฑุงุถู ุนูุฏ ุฅูุดุงุฆูุง).
- **ููู ุงููุฌุฑุฉ (Migration):** `supabase/migrations/20251101_add_governorate_visibility.sql`

**ุงูุขููุฉ:** ูุฐุง ุงูุญูู ูุนูู ูููุชุงุญ ุชุดุบูู (toggle). ุฅุฐุง ูุงูุช ูููุชู `true`ุ ุชููู ุงููุญุงูุธุฉ ูุฑุฆูุฉ ูููุณุชุฎุฏููู. ุฅุฐุง ูุงูุช `false`ุ ูุชู ุฅุฎูุงุคูุง ูู ุฌููุน ุงูุฃุฌุฒุงุก ุงูุนุงูุฉ ูู ุงูุชุทุจูู.

| ุงูุญูู | ุงูููุน | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ | ุงููุตู |
|---|---|---|---|
| `is_visible` | `BOOLEAN` | `false` | ูุชุญูู ูู ุธููุฑ ุงููุญุงูุธุฉ ูู ุงูุตูุญุงุช ุงูุนุงูุฉ. |

### 2. ุงููุงุฌูุฉ ุงูุฎูููุฉ (Backend - Server Actions)

ุชู ุฅูุดุงุก 3 ุฏูุงู ุฑุฆูุณูุฉ (Server Actions) ููุชุนุงูู ูุน ููุทู ุงููุญุงูุธุงุช:

- **`getAllGovernorates()`**: 
  - **ุงููุธููุฉ:** ุฌูุจ **ุฌููุน** ุงููุญุงูุธุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุญุงูุชูุง (`is_visible`).
  - **ุงูุงุณุชุฎุฏุงู:** ูุฎุตุตุฉ ูููุญุฉ ุชุญูู ุงูุฃุฏูู ููุทุ ูุนุฑุถ ุฌููุน ุงููุญุงูุธุงุช ูุงูุชุญูู ูููุง.

- **`getAllVisibleGovernorates()`**:
  - **ุงููุธููุฉ:** ุฌูุจ ุงููุญุงูุธุงุช ุงูุชู ุชููู `is_visible = true` **ููุท**.
  - **ุงูุงุณุชุฎุฏุงู:** ุชุณุชุฎุฏู ูู ุฌููุน ุงูุตูุญุงุช ุงูุนุงูุฉ (ูุซู ุตูุญุฉ ุงูููุงุจุ ุงูุดูุงููุ ุงูููุงุชุฑ) ูุถูุงู ุนุฏู ุธููุฑ ุงููุญุชูู ุงููุชุนูู ุจุงููุญุงูุธุงุช ุงููุฎููุฉ.

- **`updateGovernorateVisibility()`**:
  - **ุงููุธููุฉ:** ุชุญุฏูุซ ูููุฉ `is_visible` ููุญุงูุธุฉ ูุนููุฉ. 
  - **ุงูุฃูุงู:** ูุฐู ุงูุฏุงูุฉ ูุญููุฉ ูุชุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ุงูุฐู ูููู ุจุงูุนูููุฉ ูู ุฏูุฑ `admin` ุฃู `super_admin`.
  - **ุฅุนุงุฏุฉ ุงูุชุญูู (Revalidation):** ุจุนุฏ ุงูุชุญุฏูุซุ ุชููู ุจุฅุนุงุฏุฉ ุชุญููู (revalidate) ุงููุณุงุฑุงุช ุงููุชุฃุซุฑุฉ (`/`, `/deputies`, `/public-complaints`, `/app_admin/governorates`) ููุณุญ ุงููุงุด ูุนุฑุถ ุงูุจูุงูุงุช ุงููุญุฏุซุฉ ููุฑุงู.

### 3. ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Frontend)

#### ุฃ. ููุญุฉ ุชุญูู ุงูุฃุฏูู

- **ุงููุณุงุฑ:** `/app_admin/governorates`
- **ุงููุตู:** ุตูุญุฉ ูุฎุตุตุฉ ููุฃุฏูู ูุฅุฏุงุฑุฉ ุฑุคูุฉ ุงููุญุงูุธุงุช.
- **ุงูููููุงุช:**
  - **ุฌุฏูู/ุดุจูุฉ ุนุฑุถ:** ูุนุฑุถ ุฌููุน ุงููุญุงูุธุงุช (27 ูุญุงูุธุฉ).
  - **ุฅุญุตุงุฆูุงุช:** ุนุฑุถ ุนุฏุฏ ุงููุญุงูุธุงุช ุงูุฅุฌูุงููุ ุงูููุนูุฉุ ูุงููุฎููุฉ.
  - **ููุชุงุญ ุชูุนูู (Toggle Switch):** ุจุฌุงูุจ ูู ูุญุงูุธุฉ ูุชุบููุฑ ุญุงูุชูุง (ุชูุนูู/ุฅุฎูุงุก).
  - **ุฃุฒุฑุงุฑ ุณุฑูุนุฉ:** "ุฅุธูุงุฑ ุงููู" ู "ุฅุฎูุงุก ุงููู" (ูู ูุชู ุงูุนุซูุฑ ุนูููุง ูู ุงูููุฏ ุงูุญุงูู ูููููุง ูุฐููุฑุฉ ูู ุงูุชูุซูู ูููุฑุฉ).

#### ุจ. ุงูุตูุญุงุช ุงูุนุงูุฉ

- **ุตูุญุฉ ุงูููุงุจ (`/deputies`):**
  - ูุงุฆูุฉ ุงูููุงุชุฑ ุงูููุณุฏูุฉ ูููุญุงูุธุงุช ุชุณุชุฏุนู `getAllVisibleGovernorates()` ูุนุฑุถ ุงููุญุงูุธุงุช ุงูููุนูุฉ ููุท.
  - ุนูุฏ ุฌูุจ ูุงุฆูุฉ ุงูููุงุจุ ูุชู ููุชุฑุฉ ุงููุชุงุฆุฌ ุนูู ูุณุชูู ุงูุฎุงุฏู (Server-side) ูุฅุฎูุงุก ุงูููุงุจ ุงูุฐูู ููุชููู ููุญุงูุธุงุช ูุฎููุฉ (`is_visible = false`).

- **ุตูุญุฉ ุงูุดูุงูู (`/public-complaints`):**
  - ุจููุณ ุงูุทุฑููุฉุ ููุงุชุฑ ุงููุญุงูุธุงุช ููุงุฆูุฉ ุงูุดูุงูู ุชุนุฑุถ ููุท ุงูุจูุงูุงุช ุงููุชุนููุฉ ุจุงููุญุงูุธุงุช ุงูููุนูุฉ.

- **ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (`/home`):**
  - ุฃู ููููุงุช ุชุนุฑุถ ุจูุงูุงุช ูุฑุชุจุทุฉ ุจุงููุญุงูุธุงุช (ูุซู ุฅุญุตุงุฆูุงุช ุฃู ููุงุฆู) ุชุณุชุฎุฏู `getAllVisibleGovernorates()`.

---

## โจ ุงููููุฒุงุช ูุงูุฅููุงููุงุช

1.  **ุงููุดุฑ ุงูุชุฏุฑูุฌู (Progressive Rollout):**
    - ุฅููุงููุฉ ุฅุทูุงู ุงูุชุทุจูู ูู ููุงุทู ุฌุบุฑุงููุฉ ูุญุฏุฏุฉ (ูุซูุงูุ ุงูุจุฏุก ุจุงููุงูุฑุฉ ูุงูุฌูุฒุฉ) ุซู ุงูุชูุณุน ุชุฏุฑูุฌูุงู ุจุจุงูู ุงููุญุงูุธุงุช.

2.  **ุฅุฏุงุฑุฉ ูุฑูุฒูุฉ ูุณููุฉ:**
    - ูููู ููุฃุฏูู ุงูุชุญูู ุงููุงูู ูู ุงููุญุชูู ุงูุฌุบุฑุงูู ูู ูุงุฌูุฉ ุฑุณูููุฉ ุจุณูุทุฉ ุฏูู ุงูุญุงุฌุฉ ูุฃู ุชุนุฏููุงุช ุจุฑูุฌูุฉ ุฃู ุงููุตูู ููุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ.

3.  **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ (Excellent UX):**
    - ุงููุณุชุฎุฏู ุงูููุงุฆู ูุง ูุฑู ูุญุชูู ูุงุฑุบุงู ุฃู ุตูุญุงุช ุบูุฑ ููุชููุฉ. ุฅุฐุง ูุงูุช ูุญุงูุธุฉ "ุฃุณูุงู" ูุฎููุฉุ ููู ูุธูุฑ ุฃู ููุงุจ ุฃู ุดูุงูู ูููุงุ ููู ุชุธูุฑ ูู ุงูููุงุชุฑ ูู ุงูุฃุณุงุณ.

4.  **ุงูุงุฎุชุจุงุฑ ุงููุนุฒูู (Isolated Testing):**
    - ูููู ูููุทูุฑูู ุฃู ูุฑูู ุงูุฌูุฏุฉ ุชูุนูู ูุญุงูุธุฉ ูุงุญุฏุฉ ููุท ูุงุฎุชุจุงุฑ ุฌููุน ููุฒุงุช ุงูุชุทุจูู ุนูููุง ุจุดูู ูุนุฒูู ูุจู ุฅุทูุงููุง ููุฌููุน.

5.  **ุงูุฃุฏุงุก ุงูุนุงูู (High Performance):**
    - ุนูููุฉ ุงูููุชุฑุฉ ุชุชู ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู `index` ุนูู ุญูู `is_visible`ุ ููุง ูุถูู ุณุฑุนุฉ ุงูุงุณุชุนูุงูุงุช ุญุชู ูุน ูุฌูุฏ ุนุฏุฏ ูุจูุฑ ูู ุงูุณุฌูุงุช.

6.  **ูุฑููุฉ ุนุงููุฉ:**
    - ูููู ุฅุฎูุงุก ูุญุงูุธุฉ ุจุดูู ูุคูุช (ูุซูุงูุ ููุฌูุฏ ุจูุงูุงุช ุบูุฑ ููุชููุฉ) ูุฅุนุงุฏุฉ ุชูุนูููุง ูุงุญูุงู ุจุถุบุทุฉ ุฒุฑ.

---

## โ ุงูููุงุฆุฏ

- **ุชูููู ุงููุฎุงุทุฑ ุนูุฏ ุงูุฅุทูุงู:** ุจุฏูุงู ูู ุฅุทูุงู ุงูุชุทุจูู ุจุงููุงูู ูููุงุฌูุฉ ูุดุงูู ุบูุฑ ูุชููุนุฉุ ูููู ุงูุฅุทูุงู ุนูู ูุฑุงุญู ููุฑุงูุจุฉ ุงูุฃุฏุงุก ูุงููุดุงูู ูู ูุทุงู ูุญุฏูุฏ.
- **ุงูุชุฑููุฒ ุนูู ุฌูุฏุฉ ุงูุจูุงูุงุช:** ูุณูุญ ูููุฑูู ุจุงูุชุฑููุฒ ุนูู ุฌูุน ูุชุฏููู ุจูุงูุงุช ูู ูุญุงูุธุฉ ุนูู ุญุฏุฉ ูุจู ุนุฑุถูุง ูููุณุชุฎุฏููู.
- **ุงูุชุญูู ูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู:** ุชูุฌูู ุงููุณุชุฎุฏููู ูููุญุชูู ุงูููุชูู ูุงูุฌุงูุฒ ููุทุ ููุง ูุฒูุฏ ูู ุฑุถุงูู ูุซูุชูู ูู ุงูุชุทุจูู.
- **ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ:** ูููู ุฅุฎูุงุก ูุญุชูู ูุญุงูุธุฉ ุจุฃููููุง ููุฑุงู ูู ุญุงู ุงูุชุดุงู ูุดููุฉ ูุจูุฑุฉุ ุฏูู ุงูุญุงุฌุฉ ููุดุฑ ุชุญุฏูุซ ุฌุฏูุฏ ููุชุทุจูู.

---

## โ๏ธ ุงูุนููุจ ูุงููุดุงูู ุงููุญุชููุฉ

1.  **ุงูุงุนุชูุงุฏ ุนูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช (Caching):**
    - ูุนุชูุฏ ุงููุธุงู ุนูู `revalidatePath` ููุณุญ ุงููุงุด. ุฅุฐุง ูุดูุช ูุฐู ุงูุนูููุฉ ูุฃู ุณุจุจุ ูุฏ ูุง ุชุธูุฑ ุงูุชุบููุฑุงุช ูููุณุชุฎุฏููู ููุฑุงู (ุชุฃุฎูุฑ ุจุณูุท).

2.  **ุงูุดูุงูู ุงูุนุงูุฉ (General Complaints):**
    - ููุฌุฏ ูุธุงู ููุดูุงูู ุงูุนุงูุฉ (`governorate = null`). ูุฌุจ ุงูุชุฃูุฏ ูู ุฃู ููุทู ุงูููุชุฑุฉ ูุนุฑุถ ูุฐู ุงูุดูุงูู ุฏุงุฆูุงู ุญุชู ูู ูุงูุช ุฌููุน ุงููุญุงูุธุงุช ูุฎููุฉุ ุฃู ุญุณุจ ููุทู ุงูุนูู ุงููุทููุจ. ุงูุชุญููู ุงูุญุงูู ูุธูุฑ ุฃู ุงูุดูุงูู ุงูุนุงูุฉ (`!complaint.governorate`) ูุชู ุนุฑุถูุงุ ููู ุณููู ุฌูุฏ.

3.  **ุงูุจูุงูุงุช ุงููุชุฑุงุจุทุฉ:**
    - ุฅุฐุง ูุงูุช ููุงู ุฌุฏุงูู ุฃุฎุฑู ูุฑุชุจุทุฉ ุจุงููุญุงูุธุงุช ููู ูุชู ุชุญุฏูุซ ุงูููุฏ ุงูุฎุงุต ุจูุง ูููุชุฑุฉ ุงููุญุชูู ุจูุงุกู ุนูู `is_visible`ุ ููุฏ ูุคุฏู ุฐูู ุฅูู ุชุณุฑุจ ุจูุงูุงุช ูู ูุญุงูุธุงุช ูุฎููุฉ ูู ุฃูุงูู ุบูุฑ ูุชููุนุฉ.

4.  **ุงูุญุงุฌุฉ ุฅูู ุชุญุฏูุซ ุฃููุงุน TypeScript:**
    - ุงูุชูุซูู ุฐูุฑ ุฃูู ุชู ุงุณุชุฎุฏุงู `Type Assertion` ูุฃู ุฃููุงุน TypeScript ูู ูุชู ุชุญุฏูุซูุง ุจุนุฏ ุฅุถุงูุฉ ุญูู `is_visible`. ูุฐุง ูุนุชุจุฑ ุญูุงู ูุคูุชุงู ููุฏ ูุณุจุจ ุฃุฎุทุงุก ูู ุงููุณุชูุจู. ุงูุญู ุงูุฏุงุฆู ูู ุฅุนุงุฏุฉ ุชูููุฏ ุงูุฃููุงุน ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู `pnpm generate:types`.

---

## ๐ฏ ุงูุฎูุงุตุฉ

ูุธุงู ุชูุนูู ูุฅุทูุงุก ุงููุญุงูุธุงุช ูู ููุฒุฉ **ูููุฉ ููุตููุฉ ุจุดูู ุงุญุชุฑุงูู**ุ ูุชุนุชุจุฑ ูู ุฃูุถู ุงูููุงุฑุณุงุช (Best Practices) ูู ุงูุชุทุจููุงุช ุงููุจูุฑุฉ ุงูุชู ูุชู ุฅุทูุงููุง ุนูู ูุฑุงุญู. ุงููุธุงู ูููุฑ ูุฑููุฉ ูุจูุฑุฉ ููุฅุฏุงุฑุฉ ููุญุณู ูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุจุดูู ููุญูุธ.

**ุงูุชูุตูุฉ:** ุงููุธุงู ูุนุงู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู. ุงูุนููุจ ุงููุฐููุฑุฉ ุจุณูุทุฉ ููููู ุงูุชุนุงูู ูุนูุง ุจุณูููุฉ (ุฎุงุตุฉ ุชุญุฏูุซ ุฃููุงุน TypeScript). ูุงูุซ ุฃููุงุน TypeScript). ูุงูุซ ุฃููุงุน TypeScript)ุ ููุง ุชุคุซุฑ ุนูู ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ ูููุธุงู.
