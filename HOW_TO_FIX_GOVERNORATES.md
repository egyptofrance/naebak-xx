# ๐ง ุฏููู ุฅุตูุงุญ ุฃุฒุฑุงุฑ ุชูุนูู/ุฅุฎูุงุก ุงููุญุงูุธุงุช

## ๐ ุงูุฎุทูุงุช (ุจุณูุทุฉ ุฌุฏุงู - 5 ุฏูุงุฆู)

### ุงูุทุฑููุฉ ุงูุฃููู: ุนุจุฑ Supabase Dashboard (ููุตู ุจูุง โ)

1. **ุงูุชุญ Supabase Dashboard:**
   - ุงุฐูุจ ุฅูู: https://supabase.com/dashboard/project/fvpwvnghkkhrzupglsrh
   - ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจู

2. **ุงูุชุญ SQL Editor:**
   - ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุงููุณุฑูุ ุงุถุบุท ุนูู **"SQL Editor"**
   - ุงุถุบุท ุนูู **"New Query"** (ุงุณุชุนูุงู ุฌุฏูุฏ)

3. **ุงูุณุฎ ูุงูุตู ุงูููุฏ:**
   - ุงูุชุญ ููู `FIX_GOVERNORATES_RLS.sql` (ููุฌูุฏ ูู ุงููุดุฑูุน)
   - ุงูุณุฎ **ูู** ูุญุชููุงุช ุงูููู
   - ุงูุตููุง ูู ูุงูุฐุฉ SQL Editor

4. **ููุฐ ุงูููุฏ:**
   - ุงุถุบุท ุนูู ุฒุฑ **"Run"** (ุฃู Ctrl+Enter)
   - ูุฌุจ ุฃู ุชุธูุฑ ุฑุณุงูุฉ: **"Success. No rows returned"**
   - ุฅุฐุง ุธูุฑุช ุฑุณุงูุฉ ุฎุทุฃุ ุฃุฑุณููุง ูู

5. **ุงุฎุชุจุฑ ุงูุฅุตูุงุญ:**
   - ุงุฑุฌุน ูุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุญุงูุธุงุช: `/app_admin/governorates`
   - ุฌุฑุจ ุงูุถุบุท ุนูู ุฒุฑ "ุชูุนูู" ุฃู "ุฅุฎูุงุก" ูุฃู ูุญุงูุธุฉ
   - ูุฌุจ ุฃู ูุนูู ุงูุฒุฑ ููุฑุงู ูุชุชุบูุฑ ุงูุญุงูุฉ

---

### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุนุจุฑ Supabase CLI (ูููุทูุฑูู)

```bash
# 1. ุชุฃูุฏ ูู ูุฌูุฏ Supabase CLI
npx supabase --version

# 2. ุฑุจุท ุงููุดุฑูุน
npx supabase link --project-ref fvpwvnghkkhrzupglsrh

# 3. ุชุทุจูู ุงูู migration
npx supabase db push

# ุฃู ุชูููุฐ ุงูููู ูุจุงุดุฑุฉ
npx supabase db execute --file FIX_GOVERNORATES_RLS.sql
```

---

## ๐ ูุงุฐุง ููุนู ูุฐุง ุงูุฅุตูุงุญุ

ุงูููู `FIX_GOVERNORATES_RLS.sql` ูููู ุจู:

1. **ุชูุนูู Row Level Security** ุนูู ุฌุฏูู `governorates`
2. **ุฅุถุงูุฉ 4 ุณูุงุณุงุช (Policies):**
   - โ ุงูุณูุงุญ ูุฌููุน ุงููุณุชุฎุฏููู ุจูุฑุงุกุฉ ุงููุญุงูุธุงุช
   - โ ุงูุณูุงุญ **ููุฃุฏูู ููุท** ุจุชุญุฏูุซ ุงููุญุงูุธุงุช (ูุฐุง ูู ุงูุฅุตูุงุญ ุงูุฑุฆูุณู)
   - โ ุงูุณูุงุญ ููุฃุฏูู ุจุฅุถุงูุฉ ูุญุงูุธุงุช ุฌุฏูุฏุฉ
   - โ ุงูุณูุงุญ ููุฃุฏูู ุจุญุฐู ูุญุงูุธุงุช

---

## โ ููู ุชุชุฃูุฏ ุฃู ุงูุฅุตูุงุญ ูุฌุญุ

### 1. ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

ูู Supabase Dashboard > SQL Editorุ ููุฐ ูุฐุง ุงูุงุณุชุนูุงู:

```sql
SELECT 
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd
FROM pg_policies
WHERE tablename = 'governorates';
```

ูุฌุจ ุฃู ุชุฑู **4 ุณูุงุณุงุช**:
- `Anyone can view governorates`
- `Admins can update governorates`
- `Admins can insert governorates`
- `Admins can delete governorates`

### 2. ุงูุชุญูู ูู ุงููุงุฌูุฉ:

- ุงุฐูุจ ุฅูู: `/app_admin/governorates`
- ุงุถุบุท ุนูู ุฒุฑ "ุชูุนูู" ููุญุงูุธุฉ ูุฎููุฉ
- ูุฌุจ ุฃู:
  - ูุชุบูุฑ ููู ุงูุฒุฑ ููุฑุงู
  - ุชุชุบูุฑ ุงูุญุงูุฉ ูู "ูุฎููุฉ" ุฅูู "ููุนูุฉ"
  - ูุฒูุฏ ุนุฏุงุฏ "ุงููุญุงูุธุงุช ุงูููุนูุฉ" ุจููุฏุงุฑ 1

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุฌุจ ุฃู ุชููู ูุณุฌู ุฏุฎูู ูู Admin:**
   - ุชุฃูุฏ ุฃู ุญุณุงุจู ูู ุฌุฏูู `user_profiles` ูู `role = 'admin'` ุฃู `role = 'super_admin'`

2. **ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:**
   - ุงูุชุญ Console ูู ุงููุชุตูุญ (F12)
   - ุงุถุบุท ุนูู ุฒุฑ ุงูุชูุนูู/ุงูุฅุฎูุงุก
   - ุงูุณุฎ ุฃู ุฑุณุงุฆู ุฎุทุฃ ูุฃุฑุณููุง ูู

3. **ุงููููุงุช ุงููุชุนููุฉ:**
   - `FIX_GOVERNORATES_RLS.sql` - ุงูููู ุงูุฐู ุณุชููุฐู
   - `supabase/migrations/20251105_add_governorates_rls_policies.sql` - ููุณ ุงููุญุชูู (ููุชูุซูู)

---

## ๐ฏ ุงูุฎูุงุตุฉ

**ุงููุดููุฉ:** ุฌุฏูู `governorates` ูู ููู ูุฏูู RLS policiesุ ููุงูุช ุฌููุน ุนูููุงุช ุงูุชุญุฏูุซ ูุญุธูุฑุฉ.

**ุงูุญู:** ุฅุถุงูุฉ RLS policies ุชุณูุญ ููุฃุฏูู ุจุชุญุฏูุซ ุงููุญุงูุธุงุช.

**ุงูููุช ุงููุทููุจ:** 2-5 ุฏูุงุฆู ููุท.

---

**ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉุ ุฃุฑุณู ูู:**
1. ุฑุณุงูุฉ ุงูุฎุทุฃ (ุฅู ูุฌุฏุช)
2. ููุทุฉ ุดุงุดุฉ ูู SQL Editor ุจุนุฏ ุชูููุฐ ุงูููุฏ
3. ููุทุฉ ุดุงุดุฉ ูู Console ูู ุงููุชุตูุญ ุนูุฏ ุงูุถุบุท ุนูู ุงูุฒุฑ
