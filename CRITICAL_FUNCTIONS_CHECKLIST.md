# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø±Ø¬Ø© - ÙŠØ¬Ø¨ Ø§Ø®ØªØ¨Ø§Ø±Ù‡Ø§ Ø¨Ø¹Ø¯ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©

## ğŸ”´ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£ÙƒØ«Ø± Ø­Ø³Ø§Ø³ÙŠØ© (CRITICAL)

### 1. ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù€ Onboarding
**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**
- `src/data/auth/auth.ts` - Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
- `src/app/[locale]/(dynamic-pages)/(authenticated-pages)/onboarding/` - Ù…Ø³Ø§Ø± Ø§Ù„Ù€ onboarding
- `src/middlewares/onboarding-middleware.ts` - middleware Ø§Ù„Ù€ onboarding

**Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø§Ø®ØªØ¨Ø§Ø±Ù‡Ø§:**
1. âœ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ (Sign Up)
2. âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
3. âœ… ØµÙØ­Ø© Ø§Ù„Ù€ Onboarding Ø§Ù„Ø£ÙˆÙ„Ù‰
4. âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (ProfileUpdate.tsx)
5. âœ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø´Ø±ÙˆØ· (TermsAcceptance.tsx)
6. âœ… Ø¥Ø¹Ø¯Ø§Ø¯ Workspace (SetupWorkspaces.tsx)
7. âœ… ØµÙØ­Ø© Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ (FinishingUp.tsx)
8. âœ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Home Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù€ Onboarding

**Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:**
- `@supabase/supabase-js` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)
- `@supabase/ssr` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)
- `react-hook-form` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)
- `zod` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)
- `next-safe-action` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)

**âœ… Ø¢Ù…Ù†Ø©:** Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¨Ø¹ÙŠØ§Øª Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¶Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù

---

### 2. Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ù†Ø§Ø¦Ø¨ (Deputy)
**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ:**
- `src/data/admin/deputies.ts` - Ø¯Ø§Ù„Ø© `createDeputyAction`

**Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø§Ø®ØªØ¨Ø§Ø±Ù‡Ø§:**
1. âœ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªØ®Ø¯Ù… citizen
2. âœ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ù†Ø§Ø¦Ø¨"
3. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¶Ø§ÙØ© role "deputy" ÙÙŠ user_roles
4. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ deputy_profile
5. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (gender, governorate)
6. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Ø§Ø¦Ø¨ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ÙˆØ§Ø¨
7. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯

**Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:**
- `@supabase/supabase-js` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)
- `zod` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)
- `next-safe-action` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)

**âœ… Ø¢Ù…Ù†Ø©:** Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¨Ø¹ÙŠØ§Øª Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¶Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù

---

### 3. Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø¯ÙŠØ± (Manager)
**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ:**
- `src/data/admin/managers.ts` - Ø¯Ø§Ù„Ø© `promoteToManagerAction`

**Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø§Ø®ØªØ¨Ø§Ø±Ù‡Ø§:**
1. âœ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªØ®Ø¯Ù… citizen
2. âœ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø¯ÙŠØ±"
3. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø°Ù role "citizen" (Ø¥Ù† ÙˆÙØ¬Ø¯)
4. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¶Ø§ÙØ© role "manager" ÙÙŠ user_roles
5. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ manager_permissions
6. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù…Ø¯ÙŠØ±
7. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†
8. âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯

**Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:**
- `@supabase/supabase-js` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)
- `zod` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)
- `next-safe-action` âœ… (Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„Ù† ØªÙØ­Ø°Ù)

**âœ… Ø¢Ù…Ù†Ø©:** Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¨Ø¹ÙŠØ§Øª Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¶Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù

---

## ğŸŸ¡ ÙˆØ¸Ø§Ø¦Ù Ù…Ù‡Ù…Ø© Ø£Ø®Ø±Ù‰ (HIGH PRIORITY)

### 4. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Login)
**Ø§Ù„Ù…Ù„ÙØ§Øª:**
- `src/data/auth/auth.ts`
- `src/app/[locale]/(dynamic-pages)/(misc-login-pages)/auth/`

**Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:**
1. âœ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ email/password
2. âœ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ magic link
3. âœ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ OAuth (Ø¥Ù† ÙˆÙØ¬Ø¯)

### 5. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ (Complaints)
**Ø§Ù„Ù…Ù„ÙØ§Øª:**
- `src/data/complaints/complaints.ts`

**Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:**
1. âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©
2. âœ… Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰
3. âœ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø´ÙƒÙˆÙ‰
4. âœ… Ø­Ø°Ù Ø´ÙƒÙˆÙ‰

### 6. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ù†Ø§Ø¦Ø¨
**Ø§Ù„Ù…Ù„ÙØ§Øª:**
- `src/data/admin/deputy-content.tsx`

**Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª:**
1. âœ… Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù†ØªØ®Ø§Ø¨ÙŠ
2. âœ… Ø¥Ø¶Ø§ÙØ© Ø¥Ù†Ø¬Ø§Ø²
3. âœ… Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹
4. âœ… Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø«

---

## ğŸ“‹ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹

Ø¨Ø¹Ø¯ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©ØŒ Ù†ÙØ° Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø±Ø¬Ø©:

```bash
#!/bin/bash
# test-critical-functions.sh

echo "ğŸ§ª Testing Critical Functions"
echo "=============================="
echo ""

# Start the dev server in background
echo "ğŸš€ Starting dev server..."
pnpm dev > /dev/null 2>&1 &
DEV_PID=$!
sleep 10  # Wait for server to start

echo "âœ… Dev server started (PID: $DEV_PID)"
echo ""

echo "ğŸ“ Manual Testing Checklist:"
echo ""
echo "1. ğŸ”´ CRITICAL: Sign Up & Onboarding"
echo "   [ ] Go to /signup"
echo "   [ ] Register new user"
echo "   [ ] Complete onboarding flow"
echo "   [ ] Verify home page loads"
echo ""
echo "2. ğŸ”´ CRITICAL: Promote to Deputy"
echo "   [ ] Login as admin"
echo "   [ ] Go to /app_admin/users"
echo "   [ ] Select a citizen user"
echo "   [ ] Click 'Promote to Deputy'"
echo "   [ ] Verify deputy appears in /app_admin/deputies"
echo ""
echo "3. ğŸ”´ CRITICAL: Promote to Manager"
echo "   [ ] Login as admin"
echo "   [ ] Go to /app_admin/users"
echo "   [ ] Select a citizen user"
echo "   [ ] Click 'Promote to Manager'"
echo "   [ ] Verify manager appears in /app_admin/managers"
echo ""
echo "4. ğŸŸ¡ Login"
echo "   [ ] Test login with email/password"
echo "   [ ] Test magic link login"
echo ""
echo "5. ğŸŸ¡ Complaints"
echo "   [ ] Create new complaint"
echo "   [ ] View complaints list"
echo "   [ ] Update complaint status"
echo ""

read -p "Press Enter when testing is complete..."

# Kill dev server
kill $DEV_PID
echo ""
echo "âœ… Testing complete!"
```

---

## ğŸ›¡ï¸ Ø¶Ù…Ø§Ù†Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†

### Ù…Ø§ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡:

âœ… **Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø±Ø¬Ø© Ù…Ø­Ù…ÙŠØ©:**
- `@supabase/supabase-js` - âœ… Ù„Ù† ØªÙØ­Ø°Ù
- `@supabase/ssr` - âœ… Ù„Ù† ØªÙØ­Ø°Ù
- `react-hook-form` - âœ… Ù„Ù† ØªÙØ­Ø°Ù
- `zod` - âœ… Ù„Ù† ØªÙØ­Ø°Ù
- `next-safe-action` - âœ… Ù„Ù† ØªÙØ­Ø°Ù
- `next` - âœ… Ù„Ù† ØªÙØ­Ø°Ù
- `react` - âœ… Ù„Ù† ØªÙØ­Ø°Ù

âœ… **Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø­Ø°ÙÙ‡Ø§ Ù„Ø§ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø±Ø¬Ø©:**
- ÙƒÙ„ Ø§Ù„Ø­Ø²Ù… ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ:
  - Auth/Signup/Onboarding
  - Deputy promotion
  - Manager promotion

âœ… **Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¢Ù…Ù†Ø© 100% Ù„Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø±Ø¬Ø©**

---

## ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø­ØªÙ…Ù„

| Ø§Ù„ÙˆØ¸ÙŠÙØ© | Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© | ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°ÙØŸ | Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·Ø± |
|:---|:---|:---:|:---:|
| Sign Up & Onboarding | Supabase, React Hook Form, Zod | âŒ Ù„Ø§ | ğŸŸ¢ Ø¢Ù…Ù† |
| Promote to Deputy | Supabase, Zod, Next Safe Action | âŒ Ù„Ø§ | ğŸŸ¢ Ø¢Ù…Ù† |
| Promote to Manager | Supabase, Zod, Next Safe Action | âŒ Ù„Ø§ | ğŸŸ¢ Ø¢Ù…Ù† |
| Login | Supabase, Next | âŒ Ù„Ø§ | ğŸŸ¢ Ø¢Ù…Ù† |
| Complaints | Supabase, Zod | âŒ Ù„Ø§ | ğŸŸ¢ Ø¢Ù…Ù† |

---

## âœ… Ø§Ù„Ø®Ù„Ø§ØµØ©

**Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø­Ø°Ù Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª) Ø¢Ù…Ù†Ø© ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø±Ø¬Ø©:**
- Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠ ØªØ¨Ø¹ÙŠØ© Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø±Ø¬Ø© Ø¶Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø°Ù
- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø­Ø°ÙÙ‡Ø§ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠ
- ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø°Ù„Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… `depcheck`

**Ù…Ø¹ Ø°Ù„ÙƒØŒ Ø³Ù†Ø®ØªØ¨Ø± ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ù„Ù„ØªØ£ÙƒØ¯ 100%**
