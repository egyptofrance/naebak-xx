# ููุฒุงุช ุงูุจุญุซ ูุงูููุชุฑุฉ ูู ูุงุฆูุฉ ุงูููุงุจ

## ๐ ุงูุชุงุฑูุฎ
19 ุฃูุชูุจุฑ 2025

---

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ

### 1. ุฏุงูุฉ ุงูุจุญุซ ุงููุชูุฏูุฉ `searchDeputiesAction`

ุฏุงูุฉ ุฌุฏูุฏุฉ ููุจุญุซ ูุงูููุชุฑุฉ ูู ูุงุฆูุฉ ุงูููุงุจ ูุน ุฏุนู ูุงูู ููู pagination ูุงูููุงุชุฑ ุงููุชุนุฏุฏุฉ.

#### ุงููุนุงููุงุช ุงููุฏุนููุฉ:

```typescript
{
  query?: string;              // ุงูุจุญุซ ุงููุตู
  governorateId?: string;      // ููุชุฑ ุงููุญุงูุธุฉ
  partyId?: string;            // ููุชุฑ ุงูุญุฒุจ
  councilId?: string;          // ููุชุฑ ุงููุฌูุณ
  deputyStatus?: "active" | "inactive";  // ููุชุฑ ุงูุญุงูุฉ
  page?: number;               // ุฑูู ุงูุตูุญุฉ (default: 1)
  limit?: number;              // ุนุฏุฏ ุงููุชุงุฆุฌ (default: 20)
}
```

#### ุงูุจุญุซ ุงููุตู ูุดูู:
- โ ุงูุงุณู ุงููุงูู (user_profiles.full_name)
- โ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (user_profiles.email)
- โ ุฑูู ุงููุงุชู (user_profiles.phone)
- โ ุงูุฑูุฒ ุงูุงูุชุฎุงุจู (electoral_symbol)
- โ ุงูุฑูู ุงูุงูุชุฎุงุจู (electoral_number)

#### ุงูููุงุชุฑ ุงููุชุงุญุฉ:
- โ **ุงููุญุงูุธุฉ** - ุนุจุฑ user_profiles.governorate_id
- โ **ุงูุญุฒุจ** - ุนุจุฑ user_profiles.party_id
- โ **ุงููุฌูุณ** - ุนุจุฑ council_id
- โ **ุงูุญุงูุฉ** - active ุฃู inactive

#### ุงูุจูุงูุงุช ุงููุฑุฌุนุฉ:

```typescript
{
  deputies: Deputy[];      // ูุงุฆูุฉ ุงูููุงุจ
  total: number;          // ุฅุฌูุงูู ุนุฏุฏ ุงููุชุงุฆุฌ
  totalPages: number;     // ุฅุฌูุงูู ุนุฏุฏ ุงูุตูุญุงุช
  currentPage: number;    // ุงูุตูุญุฉ ุงูุญุงููุฉ
}
```

---

### 2. ูููู DeputiesList - ูุงุฌูุฉ ุงูุจุญุซ ูุงูููุชุฑุฉ

ูููู React ุฌุฏูุฏ ูููุฑ ูุงุฌูุฉ ูุณุชุฎุฏู ูุงููุฉ ููุจุญุซ ูุงูููุชุฑุฉ.

#### ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

##### ุฃ. ุดุฑูุท ุงูุจุญุซ
- ุจุญุซ ููุฑู ุนูุฏ ุงูุถุบุท ุนูู Enter
- placeholder ูุงุถุญ ูุดุฑุญ ูุง ูููู ุงูุจุญุซ ุนูู
- ุฒุฑ ุจุญุซ ูููุตู
- ุฒุฑ ูุณุญ ุงูููุงุชุฑ (ูุธูุฑ ุนูุฏ ูุฌูุฏ ููุงุชุฑ ูุดุทุฉ)

##### ุจ. ููุญุฉ ุงูููุงุชุฑ
- ูุงุจูุฉ ููุฅุธูุงุฑ/ุงูุฅุฎูุงุก ุนุจุฑ ุฒุฑ "ุฅุธูุงุฑ ุงูููุงุชุฑ"
- ุชุตููู responsive (4 ุฃุนูุฏุฉ ุนูู ุงูุดุงุดุงุช ุงููุจูุฑุฉุ ุนููุฏ ูุงุญุฏ ุนูู ุงูููุจุงูู)
- 4 ููุงุชุฑ ูููุตูุฉ:
  1. **ุงููุญุงูุธุฉ** - ูุงุฆูุฉ ููุณุฏูุฉ ุจุฌููุน ุงููุญุงูุธุงุช
  2. **ุงูุญุฒุจ** - ูุงุฆูุฉ ููุณุฏูุฉ ุจุฌููุน ุงูุฃุญุฒุงุจ ุงููุดุทุฉ
  3. **ุงููุฌูุณ** - ูุงุฆูุฉ ููุณุฏูุฉ ุจุฌููุน ุงููุฌุงูุณ ุงููุดุทุฉ
  4. **ุงูุญุงูุฉ** - ุงุฎุชูุงุฑ ุจูู ูุดุท/ุบูุฑ ูุดุท

##### ุฌ. ุฌุฏูู ุงููุชุงุฆุฌ
- ุนุฑุถ ุฌููุน ุจูุงูุงุช ุงููุงุฆุจ:
  - ุงูุงุณู
  - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  - ุงููุงุชู
  - ุงููุญุงูุธุฉ
  - ุงูุญุฒุจ
  - ุงููุฌูุณ
  - ุงูุฑูู ุงูุงูุชุฎุงุจู
  - ุงูุญุงูุฉ (ูุน badge ูููู)
  - ุฒุฑ ุชุนุฏูู
- ุฑุณุงุฆู ูุงุถุญุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ูุชุงุฆุฌ
- ุชูููุฒ ุจูู "ูุง ุชูุฌุฏ ูุชุงุฆุฌ" ู "ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุชุทุงุจู ุงูุจุญุซ"

##### ุฏ. Pagination
- ุฃุฒุฑุงุฑ ุงูุณุงุจู/ุงูุชุงูู
- ุนุฑุถ ุฑูู ุงูุตูุญุฉ ุงูุญุงููุฉ ูุฅุฌูุงูู ุงูุตูุญุงุช
- ุชุนุทูู ุงูุฃุฒุฑุงุฑ ุนูุฏ ุงูุญุงุฌุฉ
- ูุธูุฑ ููุท ุนูุฏ ูุฌูุฏ ุฃูุซุฑ ูู ุตูุญุฉ

##### ูู. ุญุงูุงุช ุงูุชุญููู
- ุฑุณุงูุฉ "ุฌุงุฑู ุงูุชุญููู..." ุฃุซูุงุก ุงูุจุญุซ
- ุชุนุทูู ุงูุฃุฒุฑุงุฑ ุฃุซูุงุก ุงูุชุญููู
- ููุน ุงูุถุบุท ุงููุชูุฑุฑ

---

## ๐ง ุงูุชูุงุตูู ุงูุชูููุฉ

### ุงุณุชุฎุฏุงู Inner Join

```typescript
user_profiles!inner (...)
```

ุงุณุชุฎุฏุงู `!inner` ูุถูู ุฃู:
- ูู ูุงุฆุจ ูู user profile ุตุญูุญ
- ูุง ุชูุฌุฏ ูุชุงุฆุฌ null ุฃู undefined
- ุงูุจูุงูุงุช ูุชุณูุฉ ููุชุฑุงุจุทุฉ

### ุงูููุชุฑุฉ ุนุจุฑ ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ

```typescript
// Filter by governorate (through user_profiles)
if (governorateId) {
  supabaseQuery = supabaseQuery.eq(
    "user_profiles.governorate_id",
    governorateId
  );
}
```

ุงูููุชุฑุฉ ุชุชู ุนุจุฑ ุงูุนูุงูุงุช ุจุดูู ุตุญูุญ ุจุงุณุชุฎุฏุงู dot notation.

### ุงูุจุญุซ ุงููุตู ุงููุชูุฏู

```typescript
supabaseQuery = supabaseQuery.or(
  `user_profiles.full_name.ilike.%${query}%,user_profiles.email.ilike.%${query}%,user_profiles.phone.ilike.%${query}%,electoral_symbol.ilike.%${query}%,electoral_number.ilike.%${query}%`
);
```

ุงูุจุญุซ ูุณุชุฎุฏู `OR` ููุจุญุซ ูู 5 ุญููู ูุฎุชููุฉ ูู ููุณ ุงูููุช.

---

## ๐ฑ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

### ุณููุงุฑูู 1: ุงูุจุญุซ ุงูุจุณูุท
1. ุงููุณุชุฎุฏู ููุชุจ "ุฃุญูุฏ" ูู ุดุฑูุท ุงูุจุญุซ
2. ูุถุบุท Enter ุฃู ุฒุฑ "ุจุญุซ"
3. ุงููุธุงู ูุจุญุซ ูู ุฌููุน ุงูุญููู ููุนุฑุถ ุงููุชุงุฆุฌ
4. ูุธูุฑ ุนุฏุฏ ุงููุชุงุฆุฌ: "ุฅุฌูุงูู 15 ูุงุฆุจ ูุณุฌู (ูููุชุฑ)"

### ุณููุงุฑูู 2: ุงูููุชุฑุฉ ุงููุชูุฏูุฉ
1. ุงููุณุชุฎุฏู ูุถุบุท "ุฅุธูุงุฑ ุงูููุงุชุฑ"
2. ูุฎุชุงุฑ ูุญุงูุธุฉ "ุงููุงูุฑุฉ"
3. ูุฎุชุงุฑ ุญุฒุจ "ุงูููุฏ"
4. ูุฎุชุงุฑ ุญุงูุฉ "ูุดุท"
5. ูุถุบุท "ุจุญุซ"
6. ุงููุธุงู ูุนุฑุถ ููุท ุงูููุงุจ ุงููุดุทูู ูู ุญุฒุจ ุงูููุฏ ูู ุงููุงูุฑุฉ

### ุณููุงุฑูู 3: ูุณุญ ุงูููุงุชุฑ
1. ุงููุณุชุฎุฏู ูุฏูู ููุงุชุฑ ูุดุทุฉ
2. ูุถุบุท ุฒุฑ "ูุณุญ ุงูููุงุชุฑ"
3. ุฌููุน ุงูููุงุชุฑ ุชููุณุญ
4. ุงููุธุงู ูุนุฑุถ ุฌููุน ุงูููุงุจ

### ุณููุงุฑูู 4: ุงูุชููู ุจูู ุงูุตูุญุงุช
1. ุงููุณุชุฎุฏู ูุฑู 20 ูุงุฆุจ ูู ุงูุตูุญุฉ ุงูุฃููู
2. ูุถุบุท "ุงูุชุงูู"
3. ุงููุธุงู ูุนุฑุถ ุงูููุงุจ ูู 21-40
4. ุงูููุงุชุฑ ูุงูุจุญุซ ูุจููู ูุดุทูู

---

## ๐จ ุงูุชุตููู ูุงููุงุฌูุฉ

### ุงูุฃููุงู ูุงูุฃููููุงุช
- ๐ **Search** - ุฃููููุฉ ุงูุจุญุซ
- ๐ฝ **Filter** - ุฃููููุฉ ุงูููุงุชุฑ
- โ **X** - ุฃููููุฉ ูุณุญ ุงูููุงุชุฑ
- โ๏ธ **Edit** - ุฃููููุฉ ุงูุชุนุฏูู
- โ **UserPlus** - ุฃููููุฉ ุฅุถุงูุฉ ูุงุฆุจ

### Badges ููุญุงูุฉ
- **ูุดุท** - Badge ุฃุฒุฑู (default variant)
- **ุบูุฑ ูุดุท** - Badge ุฑูุงุฏู (secondary variant)

### Layout
- **Desktop**: 4 ุฃุนูุฏุฉ ููููุงุชุฑ
- **Tablet**: ุนููุฏูู ููููุงุชุฑ
- **Mobile**: ุนููุฏ ูุงุญุฏ ููููุงุชุฑ

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุทูุฑูู:

```typescript
import { searchDeputiesAction } from "@/data/admin/deputies";
import { useAction } from "next-safe-action/hooks";

const { execute, isExecuting } = useAction(searchDeputiesAction);

// ุจุญุซ ุจุณูุท
const result = await execute({ 
  query: "ahmed" 
});

// ุจุญุซ ูุน ููุงุชุฑ
const result = await execute({
  query: "ahmed",
  governorateId: "gov-uuid",
  partyId: "party-uuid",
  deputyStatus: "active",
  page: 1,
  limit: 20
});

// ุงููุตูู ูููุชุงุฆุฌ
const { deputies, total, totalPages, currentPage } = result.data;
```

### ูููุณุชุฎุฏููู:

1. **ุงูุชุญ ุตูุญุฉ ุงูููุงุจ** ูู ููุญุฉ ุงูุฃุฏูู
2. **ุงูุชุจ ูู ุดุฑูุท ุงูุจุญุซ** ุฃู **ุงุถุบุท "ุฅุธูุงุฑ ุงูููุงุชุฑ"**
3. **ุงุฎุชุฑ ุงูููุงุชุฑ** ุงููุทููุจุฉ
4. **ุงุถุบุท "ุจุญุซ"** ูุชุทุจูู ุงูููุงุชุฑ
5. **ุงุณุชุฎุฏู "ุงูุณุงุจู/ุงูุชุงูู"** ููุชููู ุจูู ุงูุตูุญุงุช
6. **ุงุถุบุท "ูุณุญ ุงูููุงุชุฑ"** ููุนูุฏุฉ ูุฌููุน ุงูููุงุจ

---

## ๐ ุงูุฃุฏุงุก ูุงูุชุญุณููุงุช

### 1. Lazy Loading ููููุงุชุฑ
ุงูููุงุฆู ุงูููุณุฏูุฉ (ุงููุญุงูุธุงุชุ ุงูุฃุญุฒุงุจุ ุงููุฌุงูุณ) ุชูุญููู ูุฑุฉ ูุงุญุฏุฉ ููุท ุนูุฏ ูุชุญ ุงูุตูุญุฉ.

### 2. Debouncing (ูุณุชูุจูู)
ูููู ุฅุถุงูุฉ debouncing ููุจุญุซ ุงูููุฑู ุฃุซูุงุก ุงููุชุงุจุฉ:

```typescript
const debouncedSearch = useDebouncedCallback(
  (value: string) => {
    executeSearch({ query: value });
  },
  500
);
```

### 3. Caching (ูุณุชูุจูู)
ูููู ุฅุถุงูุฉ cache ูููุชุงุฆุฌ ุงูููุฑุฑุฉ ุจุงุณุชุฎุฏุงู React Query ุฃู SWR.

### 4. Infinite Scroll (ูุณุชูุจูู)
ุจุฏูุงู ูู paginationุ ูููู ุงุณุชุฎุฏุงู infinite scroll:

```typescript
const { data, fetchNextPage, hasNextPage } = useInfiniteQuery(...);
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู ูุทููุจุฉ
ุจุนุฏ ุฑูุน ุงูููุฏุ ูุฌุจ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู:

```bash
npm run dev
# ุฃู
npm run build && npm start
```

### 2. ุงูููุงุชุฑ ุชุนูู ูุน ุงูุจุญุซ
ูููู ุงุณุชุฎุฏุงู ุงูุจุญุซ ุงููุตู + ุงูููุงุชุฑ ูุนุงู. ูุซุงู:
- ุงูุจุญุซ: "ุฃุญูุฏ"
- ุงููุญุงูุธุฉ: "ุงููุงูุฑุฉ"
- ุงููุชูุฌุฉ: ุฌููุน ุงูููุงุจ ุงููุณููู "ุฃุญูุฏ" ูู ุงููุงูุฑุฉ

### 3. ุงููููุฉ "all" ูู ุงูููุงุชุฑ
ุนูุฏ ุงุฎุชูุงุฑ "ุฌููุน ุงููุญุงูุธุงุช" ุฃู "ุฌููุน ุงูุฃุญุฒุงุจ"ุ ูุชู ุฅุฑุณุงู `undefined` ููุณูุฑูุฑ (ูุง ูุชู ุชุทุจูู ุงูููุชุฑ).

### 4. ุงูู Pagination ูุญุงูุธ ุนูู ุงูููุงุชุฑ
ุนูุฏ ุงูุชููู ุจูู ุงูุตูุญุงุชุ ุฌููุน ุงูููุงุชุฑ ูุงูุจุญุซ ูุจููู ูุดุทูู.

---

## ๐ ุงููุฑู ุจูู ุงูุฏุงูุชูู

### `searchUsersAction` (ููุจุญุซ ูู ุงููุณุชุฎุฏููู)
- **ุงููุฏู**: ุงูุจุญุซ ูู ุงููุณุชุฎุฏููู ูุชุญููููู ุฅูู ููุงุจ
- **ุงูุฌุฏูู**: `user_profiles`
- **ุงูุงุณุชุฎุฏุงู**: ุตูุญุฉ "ุฅุถุงูุฉ ูุงุฆุจ ุฌุฏูุฏ"
- **ุงูููุฒุฉ ุงูุฎุงุตุฉ**: ูุถูู flag `isDeputy` ููู ูุณุชุฎุฏู

### `searchDeputiesAction` (ููุจุญุซ ูู ุงูููุงุจ)
- **ุงููุฏู**: ุงูุจุญุซ ูุงูููุชุฑุฉ ูู ูุงุฆูุฉ ุงูููุงุจ ุงูููุฌูุฏูู
- **ุงูุฌุฏูู**: `deputy_profiles` ูุน join ูู `user_profiles`
- **ุงูุงุณุชุฎุฏุงู**: ุตูุญุฉ "ูุงุฆูุฉ ุงูููุงุจ"
- **ุงูููุฒุฉ ุงูุฎุงุตุฉ**: ููุงุชุฑ ูุชูุฏูุฉ + pagination

---

## โ ุงูุฎูุงุตุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุจุญุซ ูููุชุฑุฉ ูุชูุฏู ููุงุฆูุฉ ุงูููุงุจ ูุดูู:

1. โ **ุฏุงูุฉ ุจุญุซ ูููุตูุฉ** (`searchDeputiesAction`)
2. โ **ูููู ูุงุฌูุฉ ูุงูู** (`DeputiesList`)
3. โ **ุจุญุซ ูุตู** ูู 5 ุญููู ูุฎุชููุฉ
4. โ **4 ููุงุชุฑ ูููุตูุฉ** (ูุญุงูุธุฉุ ุญุฒุจุ ูุฌูุณุ ุญุงูุฉ)
5. โ **Pagination** ูุน ุงูุญูุงุธ ุนูู ุงูููุงุชุฑ
6. โ **ุชุตููู responsive** ูุนูู ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ
7. โ **ุญุงูุงุช ุชุญููู** ูุฅุฏุงุฑุฉ ุฃุฎุทุงุก
8. โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ** ูุน ุฑุณุงุฆู ูุงุถุญุฉ

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู!** ๐

---

## ๐ Commits

### Commit 1: ุงููุธุงู ุงููุงูู
**Hash**: `dbd2af0`
**Message**: `feat: complete search and filter system overhaul based on database structure`

### Commit 2: ุงูุชูุซูู
**Hash**: `e1960ac`
**Message**: `docs: add complete search system documentation`

### Commit 3: ุจุญุซ ุงูููุงุจ
**Hash**: `97ea4ae`
**Message**: `feat: add advanced search and filtering for deputies list`

**ุงููููุงุช ุงููุถุงูุฉ/ุงููุนุฏูุฉ:**
- โ `src/data/admin/deputies.ts` - ุฅุถุงูุฉ `searchDeputiesAction`
- โ `src/app/.../deputies/DeputiesList.tsx` - ูููู ุฌุฏูุฏ
- โ `src/app/.../deputies/page.tsx` - ุชุญุฏูุซ ูุงุณุชุฎุฏุงู ุงููููู ุงูุฌุฏูุฏ
- โ `DEPUTIES_SEARCH_FEATURES.md` - ูุฐุง ุงูููู

**ุงูุฅุญุตุงุฆูุงุช:**
- 3 ูููุงุช ูุนุฏูุฉ
- 612 ุณุทุฑ ูุถุงู
- 161 ุณุทุฑ ูุญุฐูู

