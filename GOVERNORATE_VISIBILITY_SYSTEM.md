# ๐บ๏ธ ูุธุงู ุงูุชุญูู ูู ุฑุคูุฉ ุงููุญุงูุธุงุช - ูููุดุฑ ุงูุชุฏุฑูุฌู

**ุงูุชุงุฑูุฎ:** 1 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู ูููุดุฑ  
**Commit:** `b1072eb`

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุดุงูู ููุชุญูู ูู ุฑุคูุฉ ุงููุญุงูุธุงุช ูู ููุญุฉ ุงูุฃุฏููุ ููุง ูุชูุญ ุงููุดุฑ ุงูุชุฏุฑูุฌู ููุชุทุจูู ุนูู ูุฑุงุญู ุฏูู ุงูุญุงุฌุฉ ูุชุนุฏูู ุงูููุฏ.

### ๐ฏ ุงููุฏู ุงูุฑุฆูุณู

- **ุงููุดุฑ ุงูุชุฏุฑูุฌู:** ุงูุจุฏุก ุจูุญุงูุธุงุช ูุญุฏุฏุฉ (ูุซู ุงููุงูุฑุฉุ ุงูุฌูุฒุฉุ ุงูููููุจูุฉ) ุซู ุงูุชูุณุน ุชุฏุฑูุฌูุงู
- **ุฅุฎูุงุก ูููุณ ุญุฐู:** ุงููุญุงูุธุงุช ุงููุฎููุฉ ุชุจูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููููู ุฅุธูุงุฑูุง ูู ุฃู ููุช
- **ุงูุชุญูู ุงููุงูู:** ุฅุฏุงุฑุฉ ุณููุฉ ูู ููุญุฉ ุงูุฃุฏูู ุฏูู ุงูุญุงุฌุฉ ูุชุนุฏูู ุงูููุฏ
- **ุงูุฅุฎูุงุก ุงูุชููุงุฆู:** ุงูููุงุจ ูุงููุฑุดุญูู ูู ุงููุญุงูุธุงุช ุงููุฎููุฉ ูุชู ุฅุฎูุงุคูู ุชููุงุฆูุงู

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### Migration: `20251101_add_governorate_visibility.sql`

```sql
-- ุฅุถุงูุฉ ุญูู is_visible
ALTER TABLE governorates
ADD COLUMN IF NOT EXISTS is_visible BOOLEAN DEFAULT false;

-- ุฅุถุงูุฉ index ููุฃุฏุงุก
CREATE INDEX IF NOT EXISTS idx_governorates_is_visible 
ON governorates(is_visible);

-- ุฌููุน ุงููุญุงูุธุงุช ูุฎููุฉ ุงูุชุฑุงุถูุงู
UPDATE governorates SET is_visible = false;
```

**ุงูุญููู ุงููุถุงูุฉ:**
- `is_visible` (BOOLEAN): ูุชุญูู ูู ุฑุคูุฉ ุงููุญุงูุธุฉ
- ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ: `false` (ูุฎูู)

---

### 2. Server Actions

#### โ `getAllVisibleGovernorates.ts`
```typescript
// ุฌูุจ ุงููุญุงูุธุงุช ุงููุฑุฆูุฉ ููุท (ููุตูุญุงุช ุงูุนุงูุฉ)
export async function getAllVisibleGovernorates() {
  const { data } = await supabase
    .from("governorates")
    .select("id, name_ar, name_en")
    .eq("is_visible", true)
    .order("name_ar", { ascending: true });
  
  return data || [];
}
```

#### โ `updateGovernorateVisibility.ts`
```typescript
// ุชุญุฏูุซ ุญุงูุฉ ุฑุคูุฉ ุงููุญุงูุธุฉ (ููุฃุฏูู ููุท)
export async function updateGovernorateVisibility(
  governorateId: string,
  isVisible: boolean
) {
  // ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุฃุฏูู
  // ุชุญุฏูุซ ุงูุญุงูุฉ
  // Revalidate ุงูุตูุญุงุช ุงููุชุฃุซุฑุฉ
}
```

#### โ ุชุญุฏูุซ `getAllGovernorates.ts`
```typescript
// ุฅุถุงูุฉ ุญูู is_visible ููุงุณุชุฎุฏุงู ูู ููุญุฉ ุงูุฃุฏูู
.select("id, name_ar, name_en, is_visible")
```

---

### 3. ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุญุงูุธุงุช

**ุงููุณุงุฑ:** `/app_admin/governorates`

#### ุงููููุงุช:
1. **`page.tsx`** - Server Component
2. **`GovernoratesManagementClient.tsx`** - Client Component

#### ุงููููุฒุงุช:
- โ ุนุฑุถ ุฌููุน ุงููุญุงูุธุงุช ูู ุฌุฏูู
- โ ุฅุญุตุงุฆูุงุช (ุฅุฌูุงูู / ูุฑุฆูุฉ / ูุฎููุฉ)
- โ Toggle switch ููู ูุญุงูุธุฉ
- โ ุฃุฒุฑุงุฑ ุณุฑูุนุฉ (ุฅุธูุงุฑ ุงููู / ุฅุฎูุงุก ุงููู)
- โ ูุคุดุฑุงุช ุชุญููู
- โ ุฅุดุนุงุฑุงุช ูุฌุงุญ/ูุดู
- โ ุชุญุฏูุซ ููุฑู ูููุงุฌูุฉ

#### ูุงุฌูุฉ ุงููุณุชุฎุฏู:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุฅุฏุงุฑุฉ ุงููุญุงูุธุงุช                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โน๏ธ ููููุฉ ุงูุงุณุชุฎุฏุงู:                        โ
โ โข ูู ุจุชูุนูู ุงููุญุงูุธุงุช ุงูุชู ุชุฑูุฏ ุฅุธูุงุฑูุง   โ
โ โข ุงููุญุงูุธุงุช ุงููุฎููุฉ ูู ุชุธูุฑ ูู ุงูููุงุฆู     โ
โ โข ุงูููุงุจ ูู ุงููุญุงูุธุงุช ุงููุฎููุฉ ุณูุชู ุฅุฎูุงุคูู โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุฅุญุตุงุฆูุงุช:                                  โ
โ [27] ุฅุฌูุงูู  [3] ูุฑุฆูุฉ  [24] ูุฎููุฉ        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุงููุญุงูุธุฉ    | ุงูุฅูุฌููุฒูุฉ | ุงูุญุงูุฉ | ุงูุชุญูู โ
โ ุงููุงูุฑุฉ     | Cairo      | ๐ ูุฑุฆูุฉ | [โช๏ธ] โ
โ ุงูุฌูุฒุฉ      | Giza       | ๐ ูุฑุฆูุฉ | [โช๏ธ] โ
โ ุงูุฅุณููุฏุฑูุฉ | Alexandria | ๐ป ูุฎููุฉ | [โซ๏ธ] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### 4. ุชุทุจูู ุงูููุชุฑุฉ

#### โ ุตูุญุฉ ุงูููุงุจ (`deputies/page.tsx`)
```typescript
// ุงุณุชุฎุฏุงู ุงููุญุงูุธุงุช ุงููุฑุฆูุฉ ููุท
const governorates = await getAllVisibleGovernorates();
```

#### โ ุฌูุจ ุงูููุงุจ (`getAllDeputies.ts`)
```typescript
// ุฅุถุงูุฉ ุญูู is_visible ูู governorates
governorates (
  id, name_ar, name_en, is_visible
)

// ุชุตููุฉ ุงูููุงุจ ูู ุงููุญุงูุธุงุช ุงููุฎููุฉ
if (governorate && governorate.is_visible === false) {
  return null;
}

// ุฅุฒุงูุฉ null ูู ุงููุงุฆูุฉ
.filter((deputy) => deputy !== null)
```

#### โ ุตูุญุฉ ุงูุดูุงูู (`public-complaints/`)

**page.tsx:**
```typescript
const visibleGovernorates = await getAllVisibleGovernorates();
<PublicComplaintsClient 
  complaints={complaints}
  visibleGovernorates={visibleGovernorates}
/>
```

**PublicComplaintsClient.tsx:**
```typescript
// ููุชุฑุฉ ุงูุดูุงูู ุญุณุจ ุงููุญุงูุธุงุช ุงููุฑุฆูุฉ
const filteredComplaintsByGovernorate = useMemo(() => {
  const visibleGovNames = visibleGovernorates.map(g => g.name_ar);
  return complaints.filter(complaint => 
    !complaint.governorate || 
    visibleGovNames.includes(complaint.governorate)
  );
}, [complaints, visibleGovernorates]);

// ุงุณุชุฎุฏุงู ุงููุงุฆูุฉ ุงููููุชุฑุฉ ูู ุงูููุงุชุฑ
```

#### โ ูุงุฆูุฉ ุงูุฃุฏูู (`sidebar-admin-panel-nav.tsx`)
```typescript
{
  label: "ุฅุฏุงุฑุฉ ุงููุญุงูุธุงุช",
  href: `/app_admin/governorates`,
  icon: <Map className="h-5 w-5" />,
}
```

---

## ๐ ุณูุฑ ุงูุนูู (Workflow)

### ูููุณุคูู (Admin):

1. **ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุชุญูู**
   - ุงูุฐูุงุจ ุฅูู `/app_admin/governorates`

2. **ุงุฎุชูุงุฑ ุงููุญุงูุธุงุช**
   - ุชูุนูู ุงููุญุงูุธุงุช ุงููุทููุจุฉ (ูุซู: ุงููุงูุฑุฉุ ุงูุฌูุฒุฉุ ุงูููููุจูุฉ)
   - ุฃู ุงุณุชุฎุฏุงู ุฒุฑ "ุฅุธูุงุฑ ุงููู" / "ุฅุฎูุงุก ุงููู"

3. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู**
   - ูุชู revalidate ุงูุตูุญุงุช ุชููุงุฆูุงู
   - ุงูุชุบููุฑุงุช ุชุธูุฑ ููุฑุงู ูููุณุชุฎุฏููู

### ูููุณุชุฎุฏู ุงูุนุงุฏู:

1. **ุตูุญุฉ ุงูููุงุจ**
   - ูุฑู ููุท ุงูููุงุจ ูู ุงููุญุงูุธุงุช ุงููุฑุฆูุฉ
   - ููุชุฑ ุงููุญุงูุธุงุช ูุนุฑุถ ุงููุญุงูุธุงุช ุงููุฑุฆูุฉ ููุท

2. **ุตูุญุฉ ุงูุดูุงูู**
   - ูุฑู ููุท ุงูุดูุงูู ูู ุงููุญุงูุธุงุช ุงููุฑุฆูุฉ
   - ููุชุฑ ุงููุญุงูุธุงุช ูุนุฑุถ ุงููุญุงูุธุงุช ุงููุฑุฆูุฉ ููุท

3. **ุชุฌุฑุจุฉ ุณูุณุฉ**
   - ูุง ูุฑู ุฃู ูุญุชูู ูุงุฑุบ ุฃู ุจูุงูุงุช ูุงูุตุฉ
   - ูู ุดูุก ูุจุฏู ููุชููุงู ูููุธูุงู

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุงููููุงุช ุงููุนุฏูุฉ: 12 ููู
- โ 1 Migration
- โ 3 Server Actions (ุฌุฏูุฏ/ูุนุฏู)
- โ 2 ุตูุญุงุช ุฃุฏูู (ุฌุฏูุฏ)
- โ 6 ูููุงุช ูุนุฏูุฉ

### ุงูุฃุณุทุฑ ุงููุถุงูุฉ: +537
### ุงูุฃุณุทุฑ ุงููุญุฐููุฉ: -20

---

## ๐ฏ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### ุงูุณููุงุฑูู 1: ุงูุจุฏุก ุจุซูุงุซ ูุญุงูุธุงุช
```
1. ุชูุนูู: ุงููุงูุฑุฉุ ุงูุฌูุฒุฉุ ุงูููููุจูุฉ
2. ุงููุชูุฌุฉ:
   - ุงูููุงุจ: 150 ูุงุฆุจ (ูู 600)
   - ุงูุดูุงูู: 45 ุดููู (ูู 200)
   - ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุงููุฉ
```

### ุงูุณููุงุฑูู 2: ุงูุชูุณุน ุงูุชุฏุฑูุฌู
```
ุงูุฃุณุจูุน 1: ุงููุงูุฑุฉุ ุงูุฌูุฒุฉุ ุงูููููุจูุฉ (3 ูุญุงูุธุงุช)
ุงูุฃุณุจูุน 2: + ุงูุฅุณููุฏุฑูุฉุ ุงูุฏููููุฉ (5 ูุญุงูุธุงุช)
ุงูุฃุณุจูุน 3: + ุงูุดุฑููุฉุ ุงูุบุฑุจูุฉ (7 ูุญุงูุธุงุช)
...
ุงูุดูุฑ 3: ุฌููุน ุงููุญุงูุธุงุช (27 ูุญุงูุธุฉ)
```

### ุงูุณููุงุฑูู 3: ุงูุงุฎุชุจุงุฑ ูุงูุชุทููุฑ
```
- ุฅุฎูุงุก ุฌููุน ุงููุญุงูุธุงุช
- ุชูุนูู ูุญุงูุธุฉ ูุงุญุฏุฉ ููุงุฎุชุจุงุฑ
- ุงูุชุญูู ูู ุฌููุน ุงูููุฒุงุช
- ุงูุชูุณุน ุชุฏุฑูุฌูุงู
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. Migration ูุฌุจ ุชุดุบููู ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# ูู Supabase Dashboard ุฃู CLI
supabase db push
```

### 2. ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ
- ุฌููุน ุงููุญุงูุธุงุช **ูุฎููุฉ** ุงูุชุฑุงุถูุงู
- ูุฌุจ ุชูุนูู ุงููุญุงูุธุงุช ุงููุทููุจุฉ ูุฏููุงู

### 3. ุงูุตูุงุญูุงุช
- ููุท `super_admin` ู `admin` ูููููู ุชุนุฏูู ุญุงูุฉ ุงููุญุงูุธุงุช
- ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูุฑูู ุงููุญุงูุธุงุช ุงููุฑุฆูุฉ ููุท

### 4. ุงูุฃุฏุงุก
- ุชู ุฅุถุงูุฉ index ุนูู `is_visible` ููุฃุฏุงุก
- ุงูููุชุฑุฉ ุชุชู ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ุจุนุฏ ุงููุดุฑ:

1. **ุชุดุบูู Migration**
   ```sql
   -- ูู Supabase Dashboard > SQL Editor
   -- ุชุดุบูู: supabase/migrations/20251101_add_governorate_visibility.sql
   ```

2. **ุชูุนูู ุงููุญุงูุธุงุช ุงูุฃูููุฉ**
   ```
   - ุงูุฏุฎูู ุฅูู /app_admin/governorates
   - ุชูุนูู: ุงููุงูุฑุฉุ ุงูุฌูุฒุฉุ ุงูููููุจูุฉ
   ```

3. **ุงูุชุญูู ูู ุงููุชุงุฆุฌ**
   ```
   - ุฒูุงุฑุฉ /deputies
   - ุฒูุงุฑุฉ /public-complaints
   - ุงูุชุฃูุฏ ูู ุธููุฑ ุงููุญุชูู ุงูุตุญูุญ
   ```

4. **ุงููุฑุงูุจุฉ**
   ```
   - ูุชุงุจุนุฉ ุนุฏุฏ ุงููุณุชุฎุฏููู
   - ูุชุงุจุนุฉ ุงูุฃุฏุงุก
   - ุงูุชูุณุน ุชุฏุฑูุฌูุงู ุญุณุจ ุงูุญุงุฌุฉ
   ```

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุฃู ูุญุงูุธุงุช
**ุงูุญู:** ุชุฃูุฏ ูู ุชูุนูู ูุญุงูุธุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ูู ููุญุฉ ุงูุฃุฏูู

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุงูุชุบููุฑุงุช
**ุงูุญู:** 
1. ุชุญูู ูู ุชุดุบูู Migration
2. ุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู (admin)
3. ุงูุณุญ ุงููุงุด (Ctrl+Shift+R)

### ุงููุดููุฉ: ุฎุทุฃ ูู ุงูุตูุงุญูุงุช
**ุงูุญู:** ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏู ูุฏูู role = 'admin' ุฃู 'super_admin'

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุฅูุดุงุก ูุธุงู ุดุงูู ููุชุญูู ูู ุฑุคูุฉ ุงููุญุงูุธุงุช ูุชูุญ:

โ **ุงููุดุฑ ุงูุชุฏุฑูุฌู** - ุงูุจุฏุก ุจูุญุงูุธุงุช ูุญุฏุฏุฉ  
โ **ุฅุฏุงุฑุฉ ุณููุฉ** - ูู ููุญุฉ ุงูุฃุฏูู ุฏูู ุชุนุฏูู ุงูููุฏ  
โ **ุฅุฎูุงุก ุชููุงุฆู** - ููููุงุจ ูุงูุดูุงูู ูู ุงููุญุงูุธุงุช ุงููุฎููุฉ  
โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ** - ูุง ูุญุชูู ูุงุฑุบ ุฃู ุจูุงูุงุช ูุงูุตุฉ  
โ **ุฃุฏุงุก ูุญุณูู** - ููุชุฑุฉ ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช  
โ **ูุฑููุฉ ูุงููุฉ** - ุชูุนูู/ุฅุฎูุงุก ูู ุฃู ููุช  

---

**ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุฑูุฑ ุจูุงุณุทุฉ:** Manus AI  
**ุงูุชุงุฑูุฎ:** 1 ููููุจุฑ 2025  
**Commit:** `b1072eb`  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅูุชุงุฌ
