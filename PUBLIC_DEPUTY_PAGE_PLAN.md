# خطة إنشاء صفحة النائب العامة - خطوة بخطوة

## 📋 نظرة عامة

**الهدف:** إنشاء صفحة عامة لكل نائب يمكن لجميع المواطنين الوصول إليها بدون تسجيل دخول، تعرض جميع بيانات النائب من `user_profiles` و `deputy_profiles` والجداول المرتبطة.

**الرابط المتوقع:** `https://naebak.com/deputy/[slug]` أو `https://naebak.com/[locale]/deputy/[slug]`

---

## 🎯 المرحلة 1: إعداد قاعدة البيانات والـ Slug

### الخطوة 1.1: إضافة Slug للنواب الموجودين
**الهدف:** التأكد من أن كل نائب لديه slug فريد للوصول إلى صفحته

**الإجراءات:**
1. إنشاء دالة SQL لتوليد slug من الاسم الكامل
2. تحديث النواب الموجودين بـ slug تلقائي
3. إنشاء trigger لتوليد slug تلقائياً عند إنشاء نائب جديد

**الملفات المتوقعة:**
- `add_slug_to_deputies.sql`

**الاختبار:**
- التحقق من أن جميع النواب لديهم slug فريد
- التحقق من عمل الـ trigger عند إنشاء نائب جديد

---

### الخطوة 1.2: تحديث RLS Policies للقراءة العامة
**الهدف:** السماح بقراءة بيانات النواب بدون authentication

**الإجراءات:**
1. إنشاء أو تحديث RLS Policy لـ `deputy_profiles` للسماح بالقراءة العامة
2. التأكد من أن `user_profiles` يسمح بقراءة بيانات النواب فقط
3. التأكد من أن الجداول المرتبطة (parties, councils, governorates) متاحة للقراءة

**الملفات المتوقعة:**
- `update_deputy_rls_policies.sql`

**الاختبار:**
- محاولة قراءة بيانات نائب بدون authentication
- التأكد من عدم قراءة بيانات المواطنين العاديين

---

## 🎯 المرحلة 2: إنشاء Server Actions للبيانات

### الخطوة 2.1: إنشاء دالة لجلب بيانات النائب بالـ Slug
**الهدف:** إنشاء server action لجلب جميع بيانات النائب

**الإجراءات:**
1. إنشاء ملف `src/data/deputy/queries.ts`
2. إنشاء دالة `getDeputyBySlug(slug: string)`
3. جلب البيانات من:
   - `deputy_profiles` (JOIN مع `user_profiles`)
   - `parties` (إذا كان النائب منتمي لحزب)
   - `councils` (إذا كان النائب منتمي لمجلس)
   - `governorates` (من خلال user_profiles)
   - `deputy_scores` (الإحصائيات)
   - `ratings` (التقييمات مع حساب المتوسط)

**الملفات المتوقعة:**
- `src/data/deputy/queries.ts`

**الاختبار:**
- اختبار الدالة مع slug موجود
- اختبار الدالة مع slug غير موجود
- التأكد من إرجاع جميع البيانات المطلوبة

---

### الخطوة 2.2: إنشاء TypeScript Types
**الهدف:** تعريف أنواع البيانات بدقة

**الإجراءات:**
1. إنشاء ملف `src/types/deputy.ts`
2. تعريف interface للنائب مع جميع الحقول
3. تعريف interface للبيانات المدمجة (مع user_profiles, parties, etc.)

**الملفات المتوقعة:**
- `src/types/deputy.ts`

**الاختبار:**
- التأكد من عدم وجود أخطاء TypeScript

---

## 🎯 المرحلة 3: إنشاء صفحة النائب العامة

### الخطوة 3.1: إنشاء Dynamic Route للصفحة
**الهدف:** إنشاء المسار الديناميكي للصفحة

**الإجراءات:**
1. إنشاء مجلد `src/app/[locale]/(external-pages)/deputy/[slug]/`
2. إنشاء ملف `page.tsx` كـ Server Component
3. تطبيق Next.js 15 params (Promise)
4. جلب البيانات باستخدام `getDeputyBySlug`
5. معالجة حالة عدم وجود النائب (404)

**الملفات المتوقعة:**
- `src/app/[locale]/(external-pages)/deputy/[slug]/page.tsx`

**الاختبار:**
- الوصول إلى `/deputy/test-slug`
- التأكد من عرض البيانات أو 404

---

### الخطوة 3.2: إنشاء مكونات العرض الأساسية
**الهدف:** إنشاء المكونات لعرض بيانات النائب

**الإجراءات:**
1. إنشاء `DeputyHeader` - الهيدر مع الصورة والاسم والمنصب
2. إنشاء `DeputyInfo` - المعلومات الأساسية
3. إنشاء `DeputyBio` - السيرة الذاتية
4. إنشاء `DeputyContact` - معلومات الاتصال

**الملفات المتوقعة:**
- `src/components/deputy/DeputyHeader.tsx`
- `src/components/deputy/DeputyInfo.tsx`
- `src/components/deputy/DeputyBio.tsx`
- `src/components/deputy/DeputyContact.tsx`

**الاختبار:**
- عرض كل مكون على حدة
- التأكد من التعامل مع البيانات الناقصة (null/undefined)

---

### الخطوة 3.3: إضافة معلومات الحزب والمجلس
**الهدف:** عرض معلومات الحزب والمجلس

**الإجراءات:**
1. إنشاء `DeputyParty` - عرض معلومات الحزب مع الشعار
2. إنشاء `DeputyCouncil` - عرض معلومات المجلس

**الملفات المتوقعة:**
- `src/components/deputy/DeputyParty.tsx`
- `src/components/deputy/DeputyCouncil.tsx`

**الاختبار:**
- عرض الحزب إذا كان موجود
- عرض "مستقل" إذا لم يكن منتمي لحزب

---

## 🎯 المرحلة 4: إضافة المعلومات الانتخابية

### الخطوة 4.1: عرض البرنامج الانتخابي
**الهدف:** عرض البرنامج الانتخابي والرمز الانتخابي

**الإجراءات:**
1. إنشاء `DeputyElectoralInfo` - الرمز والرقم الانتخابي
2. إنشاء `DeputyElectoralProgram` - البرنامج الانتخابي

**الملفات المتوقعة:**
- `src/components/deputy/DeputyElectoralInfo.tsx`
- `src/components/deputy/DeputyElectoralProgram.tsx`

**الاختبار:**
- عرض البيانات الانتخابية
- التعامل مع البيانات الناقصة

---

## 🎯 المرحلة 5: إضافة الإنجازات والأحداث

### الخطوة 5.1: عرض الإنجازات
**الهدف:** عرض إنجازات النائب من جدول `achievements`

**الإجراءات:**
1. تحديث `getDeputyBySlug` لجلب الإنجازات المعتمدة
2. إنشاء `DeputyAchievements` - عرض قائمة الإنجازات

**الملفات المتوقعة:**
- `src/components/deputy/DeputyAchievements.tsx`

**الاختبار:**
- عرض الإنجازات المعتمدة فقط
- عرض رسالة إذا لم يكن هناك إنجازات

---

### الخطوة 5.2: عرض الأحداث
**الهدف:** عرض أحداث النائب من جدول `events`

**الإجراءات:**
1. تحديث `getDeputyBySlug` لجلب الأحداث المعتمدة
2. إنشاء `DeputyEvents` - عرض قائمة الأحداث

**الملفات المتوقعة:**
- `src/components/deputy/DeputyEvents.tsx`

**الاختبار:**
- عرض الأحداث المعتمدة فقط
- ترتيب الأحداث حسب التاريخ

---

## 🎯 المرحلة 6: إضافة التقييمات والإحصائيات

### الخطوة 6.1: عرض التقييمات
**الهدف:** عرض متوسط التقييمات وعددها

**الإجراءات:**
1. حساب متوسط التقييمات من جدول `ratings`
2. إنشاء `DeputyRating` - عرض النجوم والمتوسط

**الملفات المتوقعة:**
- `src/components/deputy/DeputyRating.tsx`

**الاختبار:**
- عرض التقييم الصحيح
- عرض "لا توجد تقييمات" إذا لم يكن هناك تقييمات

---

### الخطوة 6.2: عرض الإحصائيات
**الهدف:** عرض إحصائيات النائب من `deputy_scores`

**الإجراءات:**
1. إنشاء `DeputyStats` - عرض النقاط والشكاوى والترتيب

**الملفات المتوقعة:**
- `src/components/deputy/DeputyStats.tsx`

**الاختبار:**
- عرض الإحصائيات بشكل واضح
- التعامل مع البيانات الناقصة

---

## 🎯 المرحلة 7: إضافة وسائل التواصل الاجتماعي

### الخطوة 7.1: عرض روابط التواصل الاجتماعي
**الهدف:** عرض روابط Facebook, Twitter, Instagram, YouTube, Website

**الإجراءات:**
1. إنشاء `DeputySocialMedia` - عرض أيقونات وسائل التواصل

**الملفات المتوقعة:**
- `src/components/deputy/DeputySocialMedia.tsx`

**الاختبار:**
- عرض الروابط الموجودة فقط
- فتح الروابط في نافذة جديدة

---

## 🎯 المرحلة 8: تحسين التصميم والـ SEO

### الخطوة 8.1: تحسين التصميم
**الهدف:** تصميم احترافي ومتجاوب

**الإجراءات:**
1. استخدام مكونات shadcn/ui الموجودة
2. تطبيق Responsive Design
3. إضافة Banner Image في الهيدر

**الاختبار:**
- اختبار على الموبايل والتابلت والديسكتوب
- التأكد من سرعة التحميل

---

### الخطوة 8.2: إضافة SEO Metadata
**الهدف:** تحسين محركات البحث

**الإجراءات:**
1. إضافة `generateMetadata` في page.tsx
2. إضافة Open Graph tags
3. إضافة Twitter Card tags

**الملفات المتوقعة:**
- تحديث `src/app/[locale]/(external-pages)/deputy/[slug]/page.tsx`

**الاختبار:**
- فحص الـ metadata في المتصفح
- اختبار مشاركة الرابط على وسائل التواصل

---

## 🎯 المرحلة 9: إضافة ميزات إضافية (اختياري)

### الخطوة 9.1: إضافة زر "تواصل مع النائب"
**الهدف:** السماح للمواطنين بالتواصل مع النائب

**الإجراءات:**
1. إنشاء زر يوجه للتسجيل أو صفحة الشكاوى
2. عرض معلومات الاتصال (هاتف المكتب)

**الاختبار:**
- التأكد من التوجيه الصحيح

---

### الخطوة 9.2: إضافة زر "تقييم النائب"
**الهدف:** السماح للمواطنين بتقييم النائب

**الإجراءات:**
1. إنشاء زر يوجه للتسجيل أو صفحة التقييم
2. عرض التقييم الحالي

**الاختبار:**
- التأكد من التوجيه الصحيح

---

## 🎯 المرحلة 10: الاختبار النهائي والنشر

### الخطوة 10.1: اختبار شامل
**الهدف:** التأكد من عمل جميع الميزات

**الإجراءات:**
1. اختبار مع نائب لديه جميع البيانات
2. اختبار مع نائب لديه بيانات ناقصة
3. اختبار مع slug غير موجود (404)
4. اختبار الأداء (Performance)
5. اختبار على أجهزة مختلفة

---

### الخطوة 10.2: النشر النهائي
**الهدف:** نشر الصفحة على Production

**الإجراءات:**
1. مراجعة جميع الملفات
2. التأكد من عدم وجود أخطاء TypeScript
3. Push إلى GitHub
4. انتظار النشر على Vercel
5. اختبار على Production

---

## 📝 ملخص الملفات المتوقعة

### SQL Files:
1. `add_slug_to_deputies.sql`
2. `update_deputy_rls_policies.sql`

### Data Layer:
3. `src/data/deputy/queries.ts`
4. `src/types/deputy.ts`

### Pages:
5. `src/app/[locale]/(external-pages)/deputy/[slug]/page.tsx`

### Components:
6. `src/components/deputy/DeputyHeader.tsx`
7. `src/components/deputy/DeputyInfo.tsx`
8. `src/components/deputy/DeputyBio.tsx`
9. `src/components/deputy/DeputyContact.tsx`
10. `src/components/deputy/DeputyParty.tsx`
11. `src/components/deputy/DeputyCouncil.tsx`
12. `src/components/deputy/DeputyElectoralInfo.tsx`
13. `src/components/deputy/DeputyElectoralProgram.tsx`
14. `src/components/deputy/DeputyAchievements.tsx`
15. `src/components/deputy/DeputyEvents.tsx`
16. `src/components/deputy/DeputyRating.tsx`
17. `src/components/deputy/DeputyStats.tsx`
18. `src/components/deputy/DeputySocialMedia.tsx`

---

## ⚠️ نقاط مهمة للالتزام بها

### ✅ يجب:
1. **العمل خطوة بخطوة** - لا تنفذ أكثر من خطوة في commit واحد
2. **انتظار النشر** - تأكد من نجاح النشر على Vercel قبل المتابعة
3. **اختبار كل خطوة** - تأكد من عمل الميزة قبل الانتقال للتالية
4. **استخدام Next.js 15** - params و searchParams هي Promise
5. **استخدام المكونات الموجودة** - لا تعيد اختراع العجلة
6. **التعامل مع البيانات الناقصة** - استخدم Optional Chaining (?.)
7. **إبلاغ المستخدم** - أبلغني بكل خطوة وانتظر الموافقة

### ❌ لا تفعل:
1. **لا تنفذ عدة خطوات دفعة واحدة**
2. **لا تفترض وجود حقول غير موجودة في قاعدة البيانات**
3. **لا تستخدم Client Components إلا عند الضرورة**
4. **لا تنسى معالجة الأخطاء**
5. **لا تتجاهل TypeScript errors**

---

## 🚀 جاهز للبدء؟

**الخطوة التالية:** البدء بالمرحلة 1 - الخطوة 1.1 (إضافة Slug للنواب)

هل توافق على البدء؟

