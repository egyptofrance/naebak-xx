# TODO: Implementation Plan

## الهدف
تنفيذ التحديثات المطلوبة خطوة بخطوة مع التأكد من نجاح النشر بعد كل خطوة.

---

## ✅ المهام المطلوبة

### 1. نظام حالات الشكاوى والإشعارات
**الوصف:** إضافة 6 حالات جديدة للشكاوى مع 3 صيغ مختلفة (نائب/إدارة/مواطن) ونظام إشعارات للمواطنين.

**الملفات المطلوبة:**
- `src/utils/complaint-status-labels.ts` - مكتبة الصيغ المختلفة
- `src/data/complaints/send-notification.ts` - نظام إرسال الإشعارات
- تحديث `src/components/complaints/UpdateStatusForm.tsx` - زر "إرسال للمواطن"
- تحديث `src/components/complaints/PublicComplaintCard.tsx` - صيغ المواطن

**الحالات الجديدة:**
1. جديدة (new)
2. مقبولة (accepted)
3. قيد الدراسة (pending_review)
4. مرفوضة (rejected)
5. جاري العمل عليها (in_progress)
6. تم الحل (resolved)
7. لم يتم الحل (unable_to_resolve)

**الحالة:** ⏳ قيد الانتظار

---

### 2. إضافة رابط النواب في الهيدر وحذفه من السايد بار
**الوصف:** نقل رابط "النواب" من السايد بار إلى الهيدر لجميع المستخدمين.

**الملفات المطلوبة:**
- `src/components/NavigationMenu/DeputiesHeaderLink.tsx` - مكون جديد
- تحديث `src/components/NavigationMenu/InternalNavbar.tsx` - دمج الرابط
- تحديث `src/components/sidebar-user-nav.tsx` - حذف قسم النواب
- تحديث `src/components/sidebar-deputy-nav.tsx` - حذف قسم النواب
- تحديث `src/components/sidebar-admin-panel-nav.tsx` - حذف قسم النواب

**الحالة:** ⏳ قيد الانتظار

---

### 3. إضافة نوع المجلس في البيانات الإضافية للنائب
**الوصف:** عرض نوع المجلس (برلمان/شيوخ/محلي) في صفحة البيانات الإضافية للنائب.

**الملفات المطلوبة:**
- تحديث `src/rsc-data/user/deputy.ts` - جلب بيانات المجلس
- تحديث `src/app/.../deputy-data/DeputyDataForm.tsx` - عرض نوع المجلس

**المتطلبات:**
- حقل للقراءة فقط (disabled)
- يجلب البيانات من جدول `councils`
- يعرض الاسم العربي للمجلس

**الحالة:** ⏳ قيد الانتظار

---

### 4. ترجمة حالة وأهمية الشكوى مع محاذاة RTL
**الوصف:** إصلاح عرض الحالة والأهمية من الإنجليزية إلى العربية مع محاذاة RTL.

**الملفات المطلوبة:**
- `src/utils/complaint-labels.ts` - ترجمة الحالات والأهمية
- تحديث `src/app/.../deputy-complaints/page.tsx` - قائمة الشكاوى
- تحديث `src/app/.../deputy-complaints/[complaintId]/page.tsx` - تفاصيل الشكوى

**المشاكل المطلوب حلها:**
- استبدال "new" و "medium" بالترجمة العربية
- إضافة `dir="rtl"` لجميع الصفحات
- تعديل المحاذاة من اليسار إلى اليمين
- تغيير `border-left` إلى `border-right`

**الحالة:** ⏳ قيد الانتظار

---

### 5. زر إغلاق الشكوى بنجاح مع إضافة 10 نقاط للنائب
**الوصف:** زر للإدارة لإغلاق الشكوى بنجاح وإضافة 10 نقاط للنائب.

**الملفات المطلوبة:**
- `src/data/complaints/close-complaint-success.ts` - action لإضافة النقاط
- `src/components/complaints/CloseComplaintSuccessButton.tsx` - زر الإغلاق
- تحديث `src/app/.../manager-complaints/[complaintId]/page.tsx` - إضافة الزر

**المتطلبات:**
- يظهر فقط للإدارة
- يظهر فقط عندما الحالة "تم الحل"
- يضيف 10 نقاط إلى `deputy_profiles.points`
- يحدث `deputy_scores.total_points`
- يسجل الإجراء في `complaint_actions`

**ملاحظة:** ⚠️ هذه المهمة تسببت في مشاكل types - سنحاول حلها بطريقة مختلفة

**الحالة:** ⏳ قيد الانتظار

---

## 📋 خطة التنفيذ

1. ✅ الرجوع لآخر commit ناجح (`b1b3c50`)
2. ⏳ تنفيذ المهمة 1 + commit + push + انتظار نجاح النشر (3 دقائق)
3. ⏳ تنفيذ المهمة 2 + commit + push + انتظار نجاح النشر (3 دقائق)
4. ⏳ تنفيذ المهمة 3 + commit + push + انتظار نجاح النشر (3 دقائق)
5. ⏳ تنفيذ المهمة 4 + commit + push + انتظار نجاح النشر (3 دقائق)
6. ⏳ تنفيذ المهمة 5 + commit + push + انتظار نجاح النشر (3 دقائق)

---

## 🔄 الحالة الحالية

**آخر commit ناجح:** `b1b3c50`  
**Branch الاحتياطي:** `backup-before-rollback`  
**الوقت المتوقع:** ~15-20 دقيقة

---

## 📝 ملاحظات

- كل خطوة يجب أن تكون مستقلة وقابلة للنشر
- الانتظار 3 دقائق بعد كل push للتأكد من نجاح النشر على Vercel
- في حالة فشل أي خطوة، نتوقف ونصلح المشكلة قبل المتابعة
- المهمة 5 قد تحتاج طريقة مختلفة لتجنب مشاكل types

